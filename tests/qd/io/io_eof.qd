// Test basic file read
use io
use mem

fn main( -- ) {
	// Create a small file
	"ABC" mem::from_string
	-> write_len
	-> write_buf

	"/tmp/test_eof.txt" io::Write io::open if {
		-> file
		file write_buf write_len io::write if {
			drop
			file io::close
		} else {
			drop file io::close
		}
	} else {
		drop
	}

	write_buf mem::free

	// Open and read
	10 mem::alloc -> read_buf

	"/tmp/test_eof.txt" io::Read io::open if {
		-> file
		file read_buf 3 io::read if {
			-> bytes_read
			file io::close
			read_buf bytes_read mem::to_string
			.                 // Print string (destructive - frees it)
			nl                // Print newline
		} else {
			drop file io::close
		}
	} else {
		drop
	}

	read_buf mem::free
}
