// Test basic file write and read operations
use io
use mem

fn main( -- ) {
	// Write to a file: convert string to buffer
	"Hello, Quadrate!\n" mem::from_string
	-> write_len
	-> write_buf

	"/tmp/test_quadrate_io.txt" io::Write io::open if {
		-> file
		file write_buf write_len io::write if {
			drop
			file io::close
		} else {
			drop file io::close
		}
	} else {
		drop
	}

	write_buf mem::free

	// Read from the file: read to buffer, convert to string
	100 mem::alloc -> read_buf

	"/tmp/test_quadrate_io.txt" io::Read io::open if {
		-> file
		file read_buf 100 io::read if {
			-> bytes_read
			file io::close
			read_buf bytes_read mem::to_string
			prints       // Print string (non-destructive)
		} else {
			drop file io::close
		}
	} else {
		drop
	}

	read_buf mem::free
}
