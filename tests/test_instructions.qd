use math

fn test_abs() {
	push 1
	abs
	test 1

	push -1
	abs
	test 1
}

fn test_acos() {
	push 1
	acos
	test 0
}

fn test_add() {
	push 1 2
	add
	test 3

	push 1 -2
	add
	test -1

	push -1 -2
	add
	test -3

	push 1.5 2.5
	add
	test 4.0

	push 1.5 -2.5
	add
	test -1.0

	push -1.5 -2.5
	add
	test -4.0
}

fn test_asin() {
	push 1
	asin
	test 1.5707963267948966

	push -1
	asin
	test -1.5707963267948966

	push 0
	asin
	test 0
}

fn test_atan() {
	push 1
	atan
	test 0.7853981633974483

	push -1
	atan
	test -0.7853981633974483

	push 0
	atan
	test 0
}

fn test_avg() {
	push 1 2 3
	avg
	test 2

	push 1.5 2.5 3.5
	avg
	test 2.5

	push -1 -2 -3
	avg
	test -2

	push -1.5 -2.5 -3.5
	avg
	test -2.5
}

fn test_break() {
	loop
		push 1
		break
		push 2
		break
	end
	test 1
}

fn foo() {
	push 1
}

fn test_call() {
	push &foo
	call
	test 1
}

fn test_cb() {
	push 2
	cb
	test 8

	push -2
	cb
	test -8
}

fn test_cbrt() {
	push 8
	cbrt
	test 2

	push -8
	cbrt
	test -2

	push 0
	cbrt
	test 0
}

fn test_ceil() {
	push 1.5
	ceil
	test 2

	push -1.5
	ceil
	test -1

	push 0.5
	ceil
	test 1

	push -0.5
	ceil
	test 0
}

fn test_clear() {
	push 1 2 3
	clear
	test
}

fn test_continue() {
	for 0 1 3
		push $
		continue
		push 2
	end
	test 0 1 2
}

fn test_cos() {
	push 0
	cos
	test 1

	push 1
	cos
	test 0.5403023058681398

	push -1
	cos
	test 0.5403023058681398

	push 3.141592653589793
	cos
	test -1

	push -3.141592653589793
	cos
	test -1

	push 6.283185307179586
	cos
	test 1
}

fn test_dec() {
	push 1
	dec
	test 0

	push -1
	dec
	test -2

	push 0
	dec
	test -1

	push 1.5
	dec
	test 0.5

	push -1.5
	dec
	test -2.5

	push 0.5
	dec
	test -0.5

	push -0.5
	dec
	test -1.5
}

fn test_depth() {
	push 1 2 3
	depth
	test 1 2 3 3

	push 1
	depth
	test 1 1

	push 1 2
	depth
	test 1 2 2

	push 1 2 3 4
	depth
	test 1 2 3 4 4
}

fn test_div() {
	push 1 2
	div
	test 0.5

	push -1 2
	div
	test -0.5

	push 1 -2
	div
	test -0.5

	push -1 -2
	div
	test 0.5

	push 1.5 2.5
	div
	test 0.6

	push -1.5 2.5
	div
	test -0.6

	push 1.5 -2.5
	div
	test -0.6

	push -1.5 -2.5
	div
	test 0.6
}

fn test_dup() {
	push 1 2 3
	dup
	test 1 2 3 3

	push -1 -2 -3
	dup
	test -1 -2 -3 -3

	push 1.5 2.5 3.5
	dup
	test 1.5 2.5 3.5 3.5

	push -1.5 -2.5 -3.5
	dup
	test -1.5 -2.5 -3.5 -3.5
}

fn test_dup2() {
	push 1 2 3
	dup2
	test 1 2 3 2 3

	push -1 -2 -3
	dup2
	test -1 -2 -3 -2 -3

	push 1.5 2.5 3.5
	dup2
	test 1.5 2.5 3.5 2.5 3.5

	push -1.5 -2.5 -3.5
	dup2
	test -1.5 -2.5 -3.5 -2.5 -3.5
}

fn test_else() {
	push 1 2
	if gt
		push 1
	else
		push 2
	end
	test 2
}

fn test_elseif() {
	push 1 2
	if gt
		push 1
	elseif lt
		push 2
	else
		push 3
	end
	test 2
}

fn test_eval() {
	push "2 4 *"
	eval
	test 8
}

fn test_fac() {
	push 5
	fac
	test 120

	push 0
	fac
	test 1

	push 1
	fac
	test 1
}

fn test_floor() {
	push 1.5
	floor
	test 1

	push -1.5
	floor
	test -2

	push 0.5
	floor
	test 0

	push -0.5
	floor
	test -1
}

fn test_for() {
	for 0 1 3
		push $
	end
	test 0 1 2
}

fn test_if() {
	push 1 2
	if gt
		push 1
	end
	push 1 2
	if lt
		push 2
	end
	push 1 2
	if ge
		push 3
	end
	push 1 2
	if le
		push 4
	end
	push 1 2
	if eq
		push 5
	end
	push 1 2
	if ne
		push 6
	end
	test 2 4 6
}

fn test_inc() {
	push 1
	inc
	test 2

	push -1
	inc
	test 0

	push 0
	inc
	test 1

	push 1.5
	inc
	test 2.5

	push -1.5
	inc
	test -0.5

	push 0.5
	inc
	test 1.5

	push -0.5
	inc
	test 0.5
}

fn test_inv() {
	push 1
	inv
	test 1

	push 2
	inv
	test 0.5

	push -2
	inv
	test -0.5
}

fn test_je() {
	push 1 1
	je L1
	jmp Error
L1:
	push 1 0
	je Error
	push 0 1
	je Error
	return

Error:
	push -1
	test 1
}

fn test_jg() {
	push 2 1
	jg L1
	jmp Error
L1:
	push 0 0
	jg Error
	push 0 1
	jg Error
	return

Error:
	push -1
	test 1
}

fn test_jge() {
	push 1 1
	jge L1
	jmp Error
L1:
	push 2 1
	jge L2
	jmp Error
L2:
	push 0 1
	jge Error
	return

Error:
	push -1
	test 1
}

fn test_jgez() {
	push 0
	jgez L1
	jmp Error
L1:
	push 1
	jgez L2
	jmp Error
L2:
	push -1
	jgez Error
	return

Error:
	push -1
	test 1
}

fn test_jgz() {
	push 1
	jgz L1
	jmp Error
L1:
	push -1
	jgz Error
	push 0
	jgz Error
	return

Error:
	push -1
	test 1
}

fn test_jl() {
	push 1 2
	jl L1
	jmp Error
L1:
	push 0 0
	jl Error
	push 1 0
	jl Error
	return

Error:
	push -1
	test 1
}

fn test_jle() {
	push 1 1
	jle L1
	jmp Error
L1:
	push 1 2
	jle L2
	jmp Error
L2:
	push 1 0
	jle Error
	return

Error:
	push -1
	test 1
}

fn test_jlez() {
	push 0
	jlez L1
	jmp Error
L1:
	push -1
	jlez L2
	jmp Error
L2:
	push 1
	jlez Error
	return

Error:
	push -1
	test 1
}

fn test_jmp() {
	jmp L1
	push -1
L1:
	push 1
	test 1
}

fn test_jne() {
	push 1 0
	jne L1
	jmp Error
L1:
	push 1 1
	jne Error
	return

Error:
	push -1
	test 1
}

fn test_jnz() {
	push 1
	jnz L1
	jmp Error
L1:
	push -1
	jnz L2
	jmp Error
L2:
	push 0
	jnz Error
	return

Error:
	push -1
	test 1
}

fn test_jz() {
	push 0
	jz L1
	jmp Error
L1:
	push 1
	jz Error
	return

Error:
	push -1
	test 1
}

fn test_ln() {
	push 1
	ln
	test 0

	push 2
	ln
	test 0.6931471805599453

	push 1.5
	ln
	test 0.4054651081081644
}

fn test_log10() {
	push 1
	log10
	test 0

	push 10
	log10
	test 1

	push 100
	log10
	test 2

	push 1000
	log10
	test 3
}

fn test_loop() {
	loop
		push $
		dup
		push 5
		jl L1
		break
	L1:
	end
	test 0 1 2 3 4 5
}

fn test_mark() {
	push 1 2 3
	mark
	clear
	test 
	revert
	test 1 2 3
}

fn test_max() {
	push 1 2
	max
	test 2

	push -1 -2
	max
	test -1

	push 1.5 2.5
	max
	test 2.5

	push -1.5 -2.5
	max
	test -1.5

	push 1.5 -2.5
	max
	test 1.5

	push -1.5 2.5
	max
	test 2.5

	push -1.5 -2.5
	max
	test -1.5
}

fn test_min() {
	push 1 2
	min
	test 1

	push -1 -2
	min
	test -2

	push 1.5 2.5
	min
	test 1.5

	push -1.5 -2.5
	min
	test -2.5

	push 1.5 -2.5
	min
	test -2.5

	push -1.5 2.5
	min
	test -1.5

	push -1.5 -2.5
	min
	test -2.5
}

fn test_mod() {
	push 3 2
	mod
	test 1

	push 2.5 2
	mod
	test 0.5
}

fn test_mul() {
	push 1 2
	mul
	test 2

	push -1 -2
	mul
	test 2

	push 1.5 2.5
	mul
	test 3.75

	push -1.5 -2.5
	mul
	test 3.75

	push 1.5 -2.5
	mul
	test -3.75

	push -1.5 2.5
	mul
	test -3.75

	push -1.5 -2.5
	mul
	test 3.75
}

fn test_neg() {
	push 1
	neg
	test -1

	push -1
	neg
	test 1
}

fn test_nip() {
	push 1 2 3
	nip
	test 1 3

	push -1 -2 -3
	nip
	test -1 -3

	push 1.5 2.5 3.5
	nip
	test 1.5 3.5

	push -1.5 -2.5 -3.5
	nip
	test -1.5 -3.5
}

fn test_over() {
	push 1 2 3
	over
	test 1 2 3 2

	push -1 -2 -3
	over
	test -1 -2 -3 -2

	push 1.5 2.5 3.5
	over
	test 1.5 2.5 3.5 2.5

	push -1.5 -2.5 -3.5
	over
	test -1.5 -2.5 -3.5 -2.5
}

fn test_pick() {
	push 1 2 3
	pick 1
	test 1 2 3 2

	push -1 -2 -3
	pick 0
	test -1 -2 -3 -3

	push 1.5 2.5 3.5
	pick 2
	test 1.5 2.5 3.5 1.5
}

fn test_pop() {
	push 1 2 3
	pop
	test 1 2

	push 1 2 3
	pop 3
	test 
}

fn test_pow() {
	push 2 3
	pow
	test 8

	push -2 3
	pow
	test -8

	push 2 -3
	pow
	test 0.125

	push -2 -3
	pow
	test -0.125
}

fn test_push() {
	push 1 2 3
	test 1 2 3
}

fn test_reduce() {
	push 1 2 3
	reduce add
	test 6

	push 1 2 3
	reduce mul
	test 6

	push 1 2 3
	reduce sub
	test -4

	push 16 4 2
	reduce div
	test 2
}

fn test_rot() {
	push 1 2 3
	rot
	test 2 3 1

	push -1 -2 -3
	rot
	test -2 -3 -1

	push 1.5 2.5 3.5
	rot
	test 2.5 3.5 1.5

	push -1.5 -2.5 -3.5
	rot
	test -2.5 -3.5 -1.5
}

fn test_rot2() {
	push 1 2 3 4
	rot2
	test 3 4 1 2

	push -1 -2 -3 -4
	rot2
	test -3 -4 -1 -2

	push 1.5 2.5 3.5 4.5
	rot2
	test 3.5 4.5 1.5 2.5

	push -1.5 -2.5 -3.5 -4.5
	rot2
	test -3.5 -4.5 -1.5 -2.5
}

fn test_roll() {
	push 1 2 3 4
	roll 2
	test 1 3 4 2

	push 1 2 3 4
	roll 0
	test 1 2 3 4
}

fn test_round() {
	push 1.5
	round
	test 2

	push -1.5
	round
	test -2

	push 0.5
	round
	test 1

	push -0.5
	round
	test -1

	push 1.25
	round
	test 1

	push -1.25
	round
	test -1
}

fn test_sin() {
	push 0
	sin
	test 0
}

fn test_sq() {
	push 1
	sq
	test 1

	push -1
	sq
	test 1

	push 2
	sq
	test 4

	push -2
	sq
	test 4

	push 1.5
	sq
	test 2.25

	push -1.5
	sq
	test 2.25

	push 0
	sq
	test 0
}

fn test_sqrt() {
	push 4
	sqrt
	test 2

	push 0
	sqrt
	test 0

	push 1
	sqrt
	test 1

	push 2.25
	sqrt
	test 1.5
}

fn test_sub() {
	push 1 2
	sub
	test -1

	push -1 -2
	sub
	test 1

	push 1.5 2.5
	sub
	test -1.0

	push -1.5 -2.5
	sub
	test 1.0

	push 1.5 -2.5
	sub
	test 4.0

	push -1.5 2.5
	sub
	test -4.0

	push -1.5 -2.5
	sub
	test 1.0
}

fn test_sum() {
	push 1 2 3
	sum
	test 1 2 3 6

	push -1 -2 -3
	sum
	test -1 -2 -3 -6
}

fn test_swap() {
	push 1 2
	swap
	test 2 1
}

fn test_swap2() {
	push 1 2 3 4
	swap2
	test 3 4 1 2
}

fn test_tan() {
	push 0
	tan
	test 0

	push 1
	tan
	test 1.5574077246549023

	push -1
	tan
	test -1.5574077246549023
}

fn test_tuck() {
	push 1 2 3 4
	tuck
	test 1 2 4 3 4
}

fn test_within() {
	push 2 1 3
	within
	test 1

	push 2 4 3
	within
	test 0
}

fn main() {
	test_abs
	test_acos
	test_add
	test_asin
	test_atan
	test_avg
	test_break
	test_call
	test_cb
	test_cbrt
	test_ceil
	test_clear
	test_continue
	test_cos
	test_dec
	test_depth
	test_div
	test_dup
	test_dup2
	test_else
	test_elseif
	test_eval
	test_fac
	test_floor
	test_for
	test_if
	test_inc
	test_inv
	test_je
	test_jg
	test_jge
	test_jgez
	test_jgz
	test_jl
	test_jle
	test_jlez
	test_jmp
	test_jne
	test_jnz
	test_jz
	test_ln
	test_log10
	test_loop
	test_mark
	test_max
	test_min
	test_mod
	test_mul
	test_neg
	test_nip
	test_over
	test_pick
	test_pop
	test_pow
	test_push
	test_reduce
	test_rot
	test_rot2
	test_roll
	test_round
	test_sin
	test_sq
	test_sqrt
	test_sub
	test_sum
	test_swap
	test_swap2
	test_tan
	test_tuck
	test_within
}
